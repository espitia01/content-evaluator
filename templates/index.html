<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Performance Predictor Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #f0f2f5;
            color: #333;
            font-family: 'Poppins', sans-serif;
        }
        .container {
            max-width: 1200px;
            padding: 60px 20px;
        }
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            overflow: hidden;
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }
        .card-header {
            background: linear-gradient(45deg, #FF416C, #FF4B2B);
            color: white;
            text-align: center;
            padding: 30px;
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 1px;
        }
        .form-control {
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            padding: 15px;
            transition: all 0.3s ease;
            background-color: #f8f9fa;
        }
        .form-control:focus {
            border-color: #FF416C;
            box-shadow: 0 0 0 0.2rem rgba(255, 65, 108, 0.25);
            background-color: #ffffff;
        }
        .btn {
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background: linear-gradient(45deg, #FF416C, #FF4B2B);
            border: none;
        }
        .btn-primary:hover, .btn-primary:focus {
            background: linear-gradient(45deg, #FF4B2B, #FF416C);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 65, 108, 0.4);
        }
        .btn-secondary {
            background-color: #6c757d;
            border: none;
        }
        .btn-secondary:hover, .btn-secondary:focus {
            background-color: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.4);
        }
        .result-card {
            background-color: #ffffff;
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.12);
        }
        .result-card .card-body {
            padding: 30px;
        }
        .result-card .card-title {
            color: #FF416C;
            font-size: 20px;
            font-weight: 700;
        }
        .result-card .card-text {
            font-size: 40px;
            font-weight: 700;
            color: #333;
            margin-top: 10px;
        }
        .suggestions {
            background-color: #ffffff;
            border-radius: 15px;
            padding: 40px;
            margin-top: 40px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        .suggestions h4 {
            color: #FF416C;
            margin-bottom: 30px;
            font-weight: 700;
            font-size: 24px;
        }
        .suggestions ul {
            padding-left: 0;
            list-style-type: none;
        }
        .suggestion-card {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        .suggestion-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .suggestion-card i {
            color: #FF416C;
            font-size: 24px;
            margin-right: 15px;
        }
        .suggestion-card h5 {
            color: #333;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .suggestion-card p {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }
        #newPredictionBtn {
            display: none;
        }
        #performanceChart {
            margin-top: 40px;
        }
        .form-label {
            font-weight: 600;
            margin-bottom: 10px;
            color: #555;
        }
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card mb-5">
            <div class="card-header">
                <i class="fab fa-youtube"></i> YouTube Performance Predictor Pro
            </div>
            <div class="card-body p-4">
                <form id="predictionForm">
                    <div class="row g-4">
                        <div class="col-md-6">
                            <label for="channelSubscriberCount" class="form-label">
                                <i class="fas fa-users"></i> Channel Subscribers
                            </label>
                            <input type="number" class="form-control" id="channelSubscriberCount" required>
                        </div>
                        <div class="col-md-6">
                            <label for="channelVideoCount" class="form-label">
                                <i class="fas fa-video"></i> Total Videos
                            </label>
                            <input type="number" class="form-control" id="channelVideoCount" required>
                        </div>
                        <div class="col-md-6">
                            <label for="channelViewCount" class="form-label">
                                <i class="fas fa-eye"></i> Channel View Count
                            </label>
                            <input type="number" class="form-control" id="channelViewCount" required>
                        </div>
                        <div class="col-md-6">
                            <label for="channelCreatedAt" class="form-label">
                                <i class="fas fa-calendar-alt"></i> Channel Created On
                            </label>
                            <input type="date" class="form-control" id="channelCreatedAt" required>
                        </div>
                        <div class="col-md-6">
                            <label for="duration" class="form-label">
                                <i class="fas fa-clock"></i> Video Duration (seconds)
                            </label>
                            <input type="number" class="form-control" id="duration" required>
                        </div>
                    </div>
                    <div class="text-center mt-4">
                        <button type="submit" class="btn btn-primary btn-lg me-2">
                            <i class="fas fa-chart-line"></i> Predict Performance
                        </button>
                        <button type="button" id="newPredictionBtn" class="btn btn-secondary btn-lg" style="display: none;">
                            <i class="fas fa-redo"></i> New Prediction
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <div id="results" class="mt-4"></div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        function disableFormFields() {
            document.getElementById('channelSubscriberCount').disabled = true;
            document.getElementById('channelVideoCount').disabled = true;
            document.getElementById('channelViewCount').disabled = true;
            document.getElementById('channelCreatedAt').disabled = true;
            document.getElementById('duration').disabled = true;
            document.querySelector('button[type="submit"]').disabled = true;
        }

        function enableFormFields() {
            document.getElementById('channelSubscriberCount').disabled = false;
            document.getElementById('channelVideoCount').disabled = false;
            document.getElementById('channelViewCount').disabled = false;
            document.getElementById('channelCreatedAt').disabled = false;
            document.getElementById('duration').disabled = false;
            document.querySelector('button[type="submit"]').disabled = false;
        }

        async function getPrediction(formData) {
            try {
                console.log('Sending prediction request with data:', formData);
                await new Promise(resolve => setTimeout(resolve, 3000));
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const predictionData = await response.json();
                console.log('Received prediction response:', predictionData);
                return predictionData;
            } catch (error) {
                console.error('Error in getPrediction:', error);
                throw error;
            }
        }

        document.getElementById('predictionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                channel_subscriber_count: parseInt(document.getElementById('channelSubscriberCount').value),
                channel_video_count: parseInt(document.getElementById('channelVideoCount').value),
                channel_view_count: parseInt(document.getElementById('channelViewCount').value),
                channel_created_at: document.getElementById('channelCreatedAt').value,
                duration: parseInt(document.getElementById('duration').value)
            };
            
            console.log('Form submitted with data:', formData);
            
            // Show loading indicator
            document.getElementById('results').innerHTML = '<div class="text-center"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div></div>';
            
            try {
                const predictionData = await getPrediction(formData);
                console.log('Prediction successful. Displaying results...');
                displayResults(formData, predictionData);
                disableFormFields(); // Disable form fields after prediction
                document.getElementById('newPredictionBtn').style.display = 'inline-block'; // Show the New Prediction button
            } catch (error) {
                console.error('Error during prediction:', error);
                document.getElementById('results').innerHTML = `<div class="alert alert-danger" role="alert">Error: ${error.message}</div>`;
            }
        });

        document.getElementById('newPredictionBtn').addEventListener('click', function() {
            document.getElementById('predictionForm').reset();
            document.getElementById('results').innerHTML = '';
            this.style.display = 'none';
            enableFormFields(); // Enable form fields for new prediction
        });

        function displayResults(formData, predictionData) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <h3 class="text-center mb-4">Expected 7-Day Performance</h3>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card result-card">
                            <div class="card-body text-center">
                                <h5 class="card-title"><i class="fas fa-eye"></i> Views</h5>
                                <p class="card-text">${Math.round(predictionData.view_count).toLocaleString()}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card result-card">
                            <div class="card-body text-center">
                                <h5 class="card-title"><i class="fas fa-thumbs-up"></i> Likes</h5>
                                <p class="card-text">${Math.round(predictionData.like_count).toLocaleString()}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card result-card">
                            <div class="card-body text-center">
                                <h5 class="card-title"><i class="fas fa-comments"></i> Comments</h5>
                                <p class="card-text">${Math.round(predictionData.comment_count).toLocaleString()}</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <canvas id="performanceChart"></canvas>
                </div>
                <div class="suggestions mt-4">
                    <h4 class="text-center"><i class="fas fa-lightbulb"></i> Ways to Improve Reach</h4>
                    <div id="suggestionsList" class="mt-3">
                        <div class="text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading suggestions...</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Create a chart
            const ctx = document.getElementById('performanceChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Views', 'Likes', 'Comments'],
                    datasets: [{
                        label: 'Predicted 7-Day Performance',
                        data: [predictionData.view_count, predictionData.like_count, predictionData.comment_count],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            type: 'logarithmic',
                            beginAtZero: true,
                            ticks: {
                                callback: function(value, index, values) {
                                    if (value === 10 || value === 100 || value === 1000 || value === 10000 || value === 100000 || value === 1000000) {
                                        return value.toLocaleString();
                                    }
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y.toLocaleString();
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            // Generate suggestions using AI
            generateSuggestions(formData, predictionData);
        }

        async function generateSuggestions(formData, predictionData) {
            const openaiApiKey = 'OPEN_AI_API_KEY'; // Replace with your actual OpenAI API key
            const openaiEndpoint = 'https://api.openai.com/v1/chat/completions';

            const prompt = `
                Given the following YouTube channel and video data:
                - Channel Subscribers: ${formData.channel_subscriber_count}
                - Total Videos: ${formData.channel_video_count}
                - Channel View Count: ${formData.channel_view_count}
                - Channel Age: ${calculateChannelAge(formData.channel_created_at)} days
                - Video Duration: ${formData.duration} seconds

                And the predicted 7-day performance:
                - Views: ${Math.round(predictionData.view_count)}
                - Likes: ${Math.round(predictionData.like_count)}
                - Comments: ${Math.round(predictionData.comment_count)}

                Provide 5 specific, actionable suggestions to improve the reach and performance of this YouTube video. Each suggestion should be concise and directly related to the given data. Do not use any markdown formatting in your response.`;

            try {
                const response = await fetch(openaiEndpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${openaiApiKey}`
                    },
                    body: JSON.stringify({
                        model: "gpt-3.5-turbo",
                        messages: [
                            {"role": "system", "content": "You are a YouTube strategy expert providing advice to content creators. Provide clear, concise suggestions without any markdown formatting."},
                            {"role": "user", "content": prompt}
                        ],
                        max_tokens: 300,
                        n: 1,
                        temperature: 0.7,
                    })
                });

                const data = await response.json();
                const suggestions = data.choices[0].message.content.split('\n').filter(suggestion => suggestion.trim() !== '');

                const suggestionsList = document.getElementById('suggestionsList');
                suggestionsList.innerHTML = suggestions.map((suggestion, index) => {
                    // Remove numbering and any potential markdown
                    const cleanSuggestion = suggestion.replace(/^\d+\.\s*/, '').replace(/\*\*/g, '');
                    return `
                        <div class="suggestion-card">
                            <h5><i class="fas fa-star"></i> Tip ${index + 1}</h5>
                            <p>${cleanSuggestion}</p>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error generating suggestions:', error);
                document.getElementById('suggestionsList').innerHTML = '<div class="alert alert-danger" role="alert"><i class="fas fa-exclamation-triangle"></i> Unable to generate suggestions at this time.</div>';
            }
        }

        function calculateChannelAge(createdAt) {
            const creationDate = new Date(createdAt);
            const today = new Date();
            const diffTime = Math.abs(today - creationDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        // Initialize the form when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            enableFormFields(); // Ensure fields are enabled when the page loads
        });
    </script>
</body>
</html>